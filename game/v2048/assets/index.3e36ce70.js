var z=Object.defineProperty;var I=Object.getOwnPropertySymbols;var x=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var b=(o,e,t)=>e in o?z(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,M=(o,e)=>{for(var t in e||(e={}))x.call(e,t)&&b(o,t,e[t]);if(I)for(var t of I(e))G.call(e,t)&&b(o,t,e[t]);return o};var l=(o,e,t)=>(b(o,typeof e!="symbol"?e+"":e,t),t);import{G as q,d as A,o as c,c as _,w as X,T as Y,a as j,v as U,b as r,t as y,n as D,e as p,r as g,f as V,g as K,F as T,h as N,i as H,p as J,j as Q,k as W}from"./vendor.8e99c7fd.js";const Z=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const u of a.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&i(u)}).observe(document,{childList:!0,subtree:!0});function t(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerpolicy&&(a.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?a.credentials="include":s.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(s){if(s.ep)return;s.ep=!0;const a=t(s);fetch(s.href,a)}};Z();class w{constructor(e,t){l(this,"row");l(this,"column");this.row=e,this.column=t}toString(){return`tile-position-${this.row}-${this.column}`}equal(e){return this.row===e.row&&this.column===e.column}add(e){this.row+=e.row,this.column+=e.column}sub(e){this.row-=e.row,this.column-=e.column}}class B{constructor(e){l(this,"size");l(this,"tiles",[]);l(this,"availableCells",[]);l(this,"newTiles",[]);this.size=e;for(let t=0;t<e;t++)for(let i=0;i<e;i++)this.availableCells.push(new w(t,i))}inBound(e){return e.row>=0&&e.row<this.size&&e.column>=0&&e.column<this.size}addTile(e){this.tiles.push(e),this.availableCells=this.availableCells.filter(t=>!t.equal(e.position))}removeTile(e){this.tiles=this.tiles.filter(t=>t.id!==e.id),this.availableCells.push(e.position)}isAvailable(e){for(let t=0;t<this.availableCells.length;t++)if(this.availableCells[t].equal(e))return!0;return!1}getTileByPosition(e){return this.tiles.filter(t=>t.position.equal(e))[0]}randomAvailableCell(){return this.availableCells[Math.floor(Math.random()*this.availableCells.length)]}hasAvailableCells(){return this.availableCells.length>0}}const O=class{constructor(e,t){l(this,"id");l(this,"value");l(this,"mergedOut");l(this,"mergedIn");l(this,"show");l(this,"animationName");l(this,"position");l(this,"leaveAt");this.id=q.create().toString(),this.value=t,this.mergedOut=!1,this.mergedIn=!1,this.show=!0,this.animationName=O.ANIMATION_NONE,this.position=e,this.leaveAt=e}shouldMove(){return!this.position.equal(this.leaveAt)}leaveGrid(){this.position.row!==this.leaveAt.row&&(this.animationName=`row-from-${this.position.row}-to-${this.leaveAt.row}`),this.position.column!==this.leaveAt.column&&(this.animationName=`column-from-${this.position.column}-to-${this.leaveAt.column}`),this.show=!1}merge(){this.mergedIn=!1,this.value*=2}};let d=O;l(d,"ANIMATION_NONE",""),l(d,"ANIMATION_APPEAR","appear");const ee=[[3e3,["\u5927\u795E\uFF0C\u819C\u62DC\uFF01","\u9AD8\u7D20\u8D28\u4EBA\u624D\u5C31\u662F\u4E0D\u4E00\u6837\uFF0C"]],[2e3,["\u54CE\u5466\uFF0C\u76F8\u5F53\u54C7\u585E\uFF01","\u770B\u597D\u4F60,\u71C3\u8D77\u6765\u4E86\uFF01"]],[1e3,["\u534A\u5C71\u8170\u603B\u662F\u6700\u6324\u7684\uFF0C\u4F60\u5F97\u53BB\u5C71\u9876\u770B\u770B\u3002","\u54CE\u5466\uFF0C\u4E0D\u9519\u54E6\uFF01"]],[0,["\u55EF...... \u52A0\u6CB9\uFF01","\u52AA\u529B\u5427\uFF0C\u5C11\u5E74\uFF01"]]],te={size:4};class ie{constructor(e){l(this,"score",0);l(this,"grid");l(this,"gameOver",!1);l(this,"msg","");l(this,"size");l(this,"numOfMovingTiles",0);l(this,"isMoving",!1);l(this,"events");const{size:t=0,events:i={}}=M(M({},te),e);this.size=t,this.events=i,this.grid=new B(this.size),this.addRandomTile()}reStart(){this.score=0,this.gameOver=!1,this.grid=new B(this.size),this.addRandomTile()}addRandomTile(){if(this.grid.hasAvailableCells()){const e=this.grid.randomAvailableCell(),t=Math.random()<.7?2:4,i=new d(e,t);i.show=!1,i.animationName=d.ANIMATION_APPEAR,this.grid.addTile(i),i.show=!0,this.gameOver=this.ifGameOver()}}getDirection(e){let t=new w(0,0);switch(e){case"ArrowUp":t.row=-1;break;case"ArrowDown":t.row=1;break;case"ArrowLeft":t.column=-1;break;case"ArrowRight":t.column=1;break;default:return console.error("Main Managere getDirection() should not accept key ",e),t}return t}buildTraversal(e){let t=[];for(let i=0;i<2;i++){t.push([]);for(let s=0;s<this.size;s++)t[i].push(s)}return e.row===1&&t[0].reverse(),e.column===1&&t[1].reverse(),t}move(e){if(this.isMoving){console.warn("Is Moving!");return}this.isMoving=!0;const t=this.getDirection(e),i=this.buildTraversal(t);this.moveAction(t,i),this.moveAnimation(),this.events.moveCallback&&this.events.moveCallback()}moveAction(e,t){for(let i=0;i<this.size;i++)for(let s=0;s<this.size;s++){const a=new w(t[0][i],t[1][s]);if(!this.grid.isAvailable(a)){const u=this.grid.getTileByPosition(a);u instanceof d&&this.getMoveTo(u,e)}}}getMoveTo(e,t){const i=new w(e.position.row,e.position.column);for(i.add(t);this.grid.inBound(i)&&this.grid.isAvailable(i);)i.add(t);if(this.grid.inBound(i)){const s=this.grid.getTileByPosition(i);i.row=s.leaveAt.row,i.column=s.leaveAt.column,!s.mergedOut&&!s.mergedIn&&s.value===e.value?(e.mergedOut=!0,s.mergedIn=!0):i.sub(t)}else i.sub(t);e.leaveAt=i}moveAnimation(){this.grid.tiles.forEach(e=>{e.shouldMove()?(this.numOfMovingTiles+=1,e.leaveGrid()):this.grid.newTiles.push(e)}),this.numOfMovingTiles===0&&(this.grid.newTiles=[],this.isMoving=!1)}afterMove(e){if(!e.mergedOut){const t=new d(e.leaveAt,e.value);t.mergedIn=e.mergedIn,this.grid.newTiles.push(t)}this.numOfMovingTiles-=1,this.numOfMovingTiles===0&&this.afterAllMoving()}afterAllMoving(){let e=this.grid.tiles.shift();for(;e instanceof d;)this.grid.removeTile(e),e=this.grid.tiles.shift();for(e=this.grid.newTiles.shift();e instanceof d;)this.grid.addTile(e),e=this.grid.newTiles.shift();this.grid.tiles.forEach(t=>{t.mergedIn&&(t.merge(),this.score+=t.value)}),this.addRandomTile(),this.isMoving=!1}ifGameOver(){if(this.grid.hasAvailableCells())return!1;let e=!0;return this.grid.tiles.forEach(t=>{this.canMergeToAround(t)&&(e=!1)}),e}canMergeToAround(e){const t=[[0,1],[0,-1],[1,0],[-1,0]];for(let i=0;i<4;i++){const s=new w(e.position.row+t[i][0],e.position.column+t[i][1]);if(this.grid.inBound(s)&&this.grid.getTileByPosition(s).value===e.value)return!0}return!1}onGameStatusChange(e,t){if(t){let i=ee.filter(a=>a[0]<=this.score),s=Math.floor(Math.random()*2);this.msg=i.length>0?i[0][1][s]:""}else this.msg=""}}var F=(o,e)=>{const t=o.__vccOpts||o;for(const[i,s]of e)t[i]=s;return t};const se=A({props:{tile:null},emits:["after-move"],setup(o,{emit:e}){function t(i){e("after-move",i)}return(i,s)=>(c(),_(Y,{name:o.tile.animationName,onAfterLeave:s[0]||(s[0]=a=>t(o.tile))},{default:X(()=>[j(r("div",{class:D(`tile-${o.tile.value} position-row-${o.tile.position.row} position-column-${o.tile.position.column}`)},y(o.tile.value),3),[[U,o.tile.show]])]),_:1},8,["name"]))}});var oe=F(se,[["__scopeId","data-v-0e0d5184"]]);const ne=A({props:{cell:null},setup(o){return(e,t)=>(c(),p("div",{class:D(`position-row-${o.cell.row} position-column-${o.cell.column}`)},null,2))}});var le=F(ne,[["__scopeId","data-v-e261eb0c"]]);const C=o=>(J("data-v-3eca49c7"),o=o(),Q(),o),ae={id:"main"},re=C(()=>r("p",{id:"title"},"2048",-1)),ue={id:"score"},ce={id:"container"},de={key:0,id:"gameOver"},he=C(()=>r("span",null,"Try Again!",-1)),ve=[he],fe=C(()=>r("br",null,null,-1)),me=C(()=>r("br",null,null,-1)),ge={id:"msg"},pe=A({setup(o){const e=g(new ie({events:{moveCallback:$,winCallback:P,loseCallback:L}}));function t(n){e.value.afterMove(n)}function i(n){return n==="ArrowUp"||n==="ArrowDown"||n==="ArrowLeft"||n==="ArrowRight"}const s=g(),a=g(),u=g(),R=g();function $(){setTimeout(function(){var n;(n=s.value)!=null&&n.paused?s.value.play():s.value&&(s.value.load(),s.value.play())},300)}function P(){setTimeout(function(){var n;(n=a.value)==null||n.play()},300)}function L(){setTimeout(function(){var n;(n=u.value)==null||n.play()},300)}function S(n){e.value.gameOver||!i(n.key)||(n.preventDefault(),e.value.move(n.key))}let E=0,k=0;return V(()=>{window.addEventListener("keyup",S),window.addEventListener("touchstart",function(n){e.value.gameOver||(n.preventDefault(),E=n.changedTouches[0].pageX,k=n.changedTouches[0].pageY)},{passive:!1}),window.addEventListener("touchmove",function(n){if(!e.value.gameOver&&(n.preventDefault(),n.changedTouches.length)){let f=n.changedTouches[0].pageX,h=n.changedTouches[0].pageY,v=f-E,m=h-k;Math.abs(v)>Math.abs(m)&&v>0?e.value.move("ArrowRight"):Math.abs(v)>Math.abs(m)&&v<0?e.value.move("ArrowLeft"):Math.abs(m)>Math.abs(v)&&m>0?e.value.move("ArrowDown"):Math.abs(m)>Math.abs(v)&&m<0&&e.value.move("ArrowUp")}},{passive:!1})}),K(()=>e.value.gameOver,(n,f)=>{e.value.onGameStatusChange(f,n)}),(n,f)=>(c(),p(T,null,[r("div",ae,[re,r("p",ue,"score "+y(e.value.score),1),r("div",ce,[(c(!0),p(T,null,N(e.value.grid.tiles,h=>(c(),_(oe,{key:h.id.toString(),tile:h,onAfterMove:v=>t(h)},null,8,["tile","onAfterMove"]))),128)),(c(!0),p(T,null,N(e.value.grid.availableCells,h=>(c(),_(le,{cell:h},null,8,["cell"]))),256))]),e.value.gameOver?(c(),p("div",de,[r("button",{onClick:f[0]||(f[0]=h=>e.value.reStart())},ve),fe,me,r("p",ge,y(e.value.msg),1)])):H("",!0)]),r("audio",{ref_key:"clickAudioRef",ref:s,style:{display:"none"},controls:"",src:"./audio/click.mp3"},null,512),r("audio",{ref_key:"winAudioRef",ref:a,style:{display:"none"},controls:"",src:"./audio/win.mp3"},null,512),r("audio",{ref_key:"loseAudioRef",ref:u,style:{display:"none"},controls:"",src:"./audio/lose.mp3"},null,512),r("audio",{ref_key:"welAudioRef",ref:R,style:{display:"none"},controls:"",src:"./audio/welcome.mp3"},null,512)],64))}});var we=F(pe,[["__scopeId","data-v-3eca49c7"]]);const _e=A({setup(o){return(e,t)=>(c(),_(we))}});W(_e).mount("#app");
