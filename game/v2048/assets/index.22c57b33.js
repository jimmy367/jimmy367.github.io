var N=Object.defineProperty;var $=(o,e,t)=>e in o?N(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var r=(o,e,t)=>($(o,typeof e!="symbol"?e+"":e,t),t);import{G as E,d as _,o as u,c as w,w as P,T as L,a as k,v as B,b as m,t as y,n as C,e as f,r as D,f as x,F as T,g as b,h as z,p as R,i as S,j as G}from"./vendor.483e7612.js";const q=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function t(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerpolicy&&(a.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?a.credentials="include":s.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(s){if(s.ep)return;s.ep=!0;const a=t(s);fetch(s.href,a)}};q();class g{constructor(e,t){r(this,"row");r(this,"column");this.row=e,this.column=t}toString(){return`tile-position-${this.row}-${this.column}`}equal(e){return this.row===e.row&&this.column===e.column}add(e){this.row+=e.row,this.column+=e.column}sub(e){this.row-=e.row,this.column-=e.column}}class O{constructor(e){r(this,"size");r(this,"tiles",[]);r(this,"availableCells",[]);r(this,"newTiles",[]);this.size=e;for(let t=0;t<e;t++)for(let i=0;i<e;i++)this.availableCells.push(new g(t,i))}inBound(e){return e.row>=0&&e.row<this.size&&e.column>=0&&e.column<this.size}addTile(e){this.tiles.push(e),this.availableCells=this.availableCells.filter(t=>!t.equal(e.position))}removeTile(e){this.tiles=this.tiles.filter(t=>t.id!==e.id),this.availableCells.push(e.position)}isAvailable(e){for(let t=0;t<this.availableCells.length;t++)if(this.availableCells[t].equal(e))return!0;return!1}getTileByPosition(e){return this.tiles.filter(t=>t.position.equal(e))[0]}randomAvailableCell(){return this.availableCells[Math.floor(Math.random()*this.availableCells.length)]}hasAvailableCells(){return this.availableCells.length>0}}const M=class{constructor(e,t){r(this,"id");r(this,"value");r(this,"mergedOut");r(this,"mergedIn");r(this,"show");r(this,"animationName");r(this,"position");r(this,"leaveAt");this.id=E.create().toString(),this.value=t,this.mergedOut=!1,this.mergedIn=!1,this.show=!0,this.animationName=M.ANIMATION_NONE,this.position=e,this.leaveAt=e}shouldMove(){return!this.position.equal(this.leaveAt)}leaveGrid(){this.position.row!==this.leaveAt.row&&(this.animationName=`row-from-${this.position.row}-to-${this.leaveAt.row}`),this.position.column!==this.leaveAt.column&&(this.animationName=`column-from-${this.position.column}-to-${this.leaveAt.column}`),this.show=!1}merge(){this.mergedIn=!1,this.value*=2}};let h=M;r(h,"ANIMATION_NONE",""),r(h,"ANIMATION_APPEAR","appear");class X{constructor(e=4){r(this,"size");r(this,"score",0);r(this,"grid");r(this,"gameOver",!1);r(this,"numOfMovingTiles",0);r(this,"isMoving",!1);this.size=e,this.grid=new O(this.size),this.addRandomTile()}setup(){this.score=0,this.gameOver=!1,this.grid=new O(this.size),this.addRandomTile()}addRandomTile(){if(this.grid.hasAvailableCells()){const e=this.grid.randomAvailableCell(),t=Math.random()<.7?2:4,i=new h(e,t);i.show=!1,i.animationName=h.ANIMATION_APPEAR,this.grid.addTile(i),i.show=!0,this.gameOver=this.ifGameOver()}}getDirection(e){let t=new g(0,0);switch(e){case"ArrowUp":t.row=-1;break;case"ArrowDown":t.row=1;break;case"ArrowLeft":t.column=-1;break;case"ArrowRight":t.column=1;break;default:return console.error("Main Managere getDirection() should not accept key ",e),t}return t}buildTraversal(e){let t=[];for(let i=0;i<2;i++){t.push([]);for(let s=0;s<this.size;s++)t[i].push(s)}return e.row===1&&t[0].reverse(),e.column===1&&t[1].reverse(),t}move(e){if(this.isMoving){console.warn("Is Moving!");return}this.isMoving=!0;const t=this.getDirection(e),i=this.buildTraversal(t);this.moveAction(t,i),this.moveAnimation()}moveAction(e,t){for(let i=0;i<this.size;i++)for(let s=0;s<this.size;s++){const a=new g(t[0][i],t[1][s]);if(!this.grid.isAvailable(a)){const l=this.grid.getTileByPosition(a);l instanceof h&&this.getMoveTo(l,e)}}}getMoveTo(e,t){const i=new g(e.position.row,e.position.column);for(i.add(t);this.grid.inBound(i)&&this.grid.isAvailable(i);)i.add(t);if(this.grid.inBound(i)){const s=this.grid.getTileByPosition(i);i.row=s.leaveAt.row,i.column=s.leaveAt.column,!s.mergedOut&&!s.mergedIn&&s.value===e.value?(e.mergedOut=!0,s.mergedIn=!0):i.sub(t)}else i.sub(t);e.leaveAt=i}moveAnimation(){this.grid.tiles.forEach(e=>{e.shouldMove()?(this.numOfMovingTiles+=1,e.leaveGrid()):this.grid.newTiles.push(e)}),this.numOfMovingTiles===0&&(this.grid.newTiles=[],this.isMoving=!1)}afterMove(e){if(!e.mergedOut){const t=new h(e.leaveAt,e.value);t.mergedIn=e.mergedIn,this.grid.newTiles.push(t)}this.numOfMovingTiles-=1,this.numOfMovingTiles===0&&this.afterAllMoving()}afterAllMoving(){let e=this.grid.tiles.shift();for(;e instanceof h;)this.grid.removeTile(e),e=this.grid.tiles.shift();for(e=this.grid.newTiles.shift();e instanceof h;)this.grid.addTile(e),e=this.grid.newTiles.shift();this.grid.tiles.forEach(t=>{t.mergedIn&&(t.merge(),this.score+=t.value)}),this.addRandomTile(),this.isMoving=!1}ifGameOver(){if(this.grid.hasAvailableCells())return!1;let e=!0;return this.grid.tiles.forEach(t=>{this.canMergeToAround(t)&&(e=!1)}),e}canMergeToAround(e){const t=[[0,1],[0,-1],[1,0],[-1,0]];for(let i=0;i<4;i++){const s=new g(e.position.row+t[i][0],e.position.column+t[i][1]);if(this.grid.inBound(s)&&this.grid.getTileByPosition(s).value===e.value)return!0}return!1}}var A=(o,e)=>{const t=o.__vccOpts||o;for(const[i,s]of e)t[i]=s;return t};const Y=_({props:{tile:null},emits:["after-move"],setup(o,{emit:e}){function t(i){e("after-move",i)}return(i,s)=>(u(),w(L,{name:o.tile.animationName,onAfterLeave:s[0]||(s[0]=a=>t(o.tile))},{default:P(()=>[k(m("div",{class:C(`tile-${o.tile.value} position-row-${o.tile.position.row} position-column-${o.tile.position.column}`)},y(o.tile.value),3),[[B,o.tile.show]])]),_:1},8,["name"]))}});var j=A(Y,[["__scopeId","data-v-1291d475"]]);const F=_({props:{cell:null},setup(o){return(e,t)=>(u(),f("div",{class:C(`position-row-${o.cell.row} position-column-${o.cell.column}`)},null,2))}});var U=A(F,[["__scopeId","data-v-288e2fed"]]);const I=o=>(R("data-v-547a539c"),o=o(),S(),o),K={id:"main"},V=I(()=>m("p",{id:"title"},"2048",-1)),H={id:"score"},J={id:"container"},Q={key:0,id:"gameOver"},W=I(()=>m("span",null,"Try Again!",-1)),Z=[W],ee=_({setup(o){const e=D(new X);function t(n){e.value.afterMove(n)}function i(n){return n==="ArrowUp"||n==="ArrowDown"||n==="ArrowLeft"||n==="ArrowRight"}function s(n){e.value.gameOver||!i(n.key)||(n.preventDefault(),e.value.move(n.key))}let a=0,l=0;return x(()=>{window.addEventListener("keyup",s),window.addEventListener("touchstart",function(n){e.value.gameOver||(n.preventDefault(),a=n.changedTouches[0].pageX,l=n.changedTouches[0].pageY)},{passive:!1}),window.addEventListener("touchmove",function(n){if(!e.value.gameOver&&(n.preventDefault(),n.changedTouches.length)){let p=n.changedTouches[0].pageX,c=n.changedTouches[0].pageY,d=p-a,v=c-l;Math.abs(d)>Math.abs(v)&&d>0?e.value.move("ArrowRight"):Math.abs(d)>Math.abs(v)&&d<0?e.value.move("ArrowLeft"):Math.abs(v)>Math.abs(d)&&v>0?e.value.move("ArrowDown"):Math.abs(v)>Math.abs(d)&&v<0&&e.value.move("ArrowUp")}},{passive:!1})}),(n,p)=>(u(),f("div",K,[V,m("p",H,"score "+y(e.value.score),1),m("div",J,[(u(!0),f(T,null,b(e.value.grid.tiles,c=>(u(),w(j,{key:c.id.toString(),tile:c,onAfterMove:d=>t(c)},null,8,["tile","onAfterMove"]))),128)),(u(!0),f(T,null,b(e.value.grid.availableCells,c=>(u(),w(U,{cell:c},null,8,["cell"]))),256))]),e.value.gameOver?(u(),f("div",Q,[m("button",{onClick:p[0]||(p[0]=c=>e.value.setup())},Z)])):z("",!0)]))}});var te=A(ee,[["__scopeId","data-v-547a539c"]]);const ie=_({setup(o){return(e,t)=>(u(),w(te))}});G(ie).mount("#app");
