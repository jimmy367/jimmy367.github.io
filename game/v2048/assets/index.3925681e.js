var x=Object.defineProperty;var k=Object.getOwnPropertySymbols;var G=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;var M=(o,e,t)=>e in o?x(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,T=(o,e)=>{for(var t in e||(e={}))G.call(e,t)&&M(o,t,e[t]);if(k)for(var t of k(e))q.call(e,t)&&M(o,t,e[t]);return o};var n=(o,e,t)=>(M(o,typeof e!="symbol"?e+"":e,t),t);import{G as X,d as C,o as c,c as A,w as Y,T as j,a as U,v as V,b as r,t as y,n as R,e as p,r as g,f as K,g as H,F,h as I,i as J,p as Q,j as W,k as Z}from"./vendor.8e99c7fd.js";const ee=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const u of a.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&i(u)}).observe(document,{childList:!0,subtree:!0});function t(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerpolicy&&(a.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?a.credentials="include":s.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(s){if(s.ep)return;s.ep=!0;const a=t(s);fetch(s.href,a)}};ee();class w{constructor(e,t){n(this,"row");n(this,"column");this.row=e,this.column=t}toString(){return`tile-position-${this.row}-${this.column}`}equal(e){return this.row===e.row&&this.column===e.column}add(e){this.row+=e.row,this.column+=e.column}sub(e){this.row-=e.row,this.column-=e.column}}class N{constructor(e){n(this,"size");n(this,"tiles",[]);n(this,"availableCells",[]);n(this,"newTiles",[]);this.size=e;for(let t=0;t<e;t++)for(let i=0;i<e;i++)this.availableCells.push(new w(t,i))}inBound(e){return e.row>=0&&e.row<this.size&&e.column>=0&&e.column<this.size}addTile(e){this.tiles.push(e),this.availableCells=this.availableCells.filter(t=>!t.equal(e.position))}removeTile(e){this.tiles=this.tiles.filter(t=>t.id!==e.id),this.availableCells.push(e.position)}isAvailable(e){for(let t=0;t<this.availableCells.length;t++)if(this.availableCells[t].equal(e))return!0;return!1}getTileByPosition(e){return this.tiles.filter(t=>t.position.equal(e))[0]}randomAvailableCell(){return this.availableCells[Math.floor(Math.random()*this.availableCells.length)]}hasAvailableCells(){return this.availableCells.length>0}}const O=class{constructor(e,t){n(this,"id");n(this,"value");n(this,"mergedOut");n(this,"mergedIn");n(this,"show");n(this,"animationName");n(this,"position");n(this,"leaveAt");this.id=X.create().toString(),this.value=t,this.mergedOut=!1,this.mergedIn=!1,this.show=!0,this.animationName=O.ANIMATION_NONE,this.position=e,this.leaveAt=e}shouldMove(){return!this.position.equal(this.leaveAt)}leaveGrid(){this.position.row!==this.leaveAt.row&&(this.animationName=`row-from-${this.position.row}-to-${this.leaveAt.row}`),this.position.column!==this.leaveAt.column&&(this.animationName=`column-from-${this.position.column}-to-${this.leaveAt.column}`),this.show=!1}merge(){this.mergedIn=!1,this.value*=2}};let d=O;n(d,"ANIMATION_NONE",""),n(d,"ANIMATION_APPEAR","appear");const te=[[5e3,["\u98CE\u884C\u5929\u4E0B\uFF0C\u8C01\u4E0E\u4E89\u950B\u3002","\u5927\u795E\uFF0C\u819C\u62DC\uFF01"]],[3500,["\u9AD8\u7D20\u8D28\u4EBA\u624D\u5C31\u662F\u4E0D\u4E00\u6837\uFF01","\u5DF2\u6C89\u9189\u5728\u5144\u53F0\u8FD9\u9AD8\u7EDD\u7684\u80FD\u529B\u4E4B\u4E2D\u3002"]],[2500,["\u54CE\u5466\uFF0C\u76F8\u5F53\u54C7\u585E\uFF01","\u770B\u597D\u4F60,\u71C3\u8D77\u6765\u4E86\uFF01"]],[1500,["\u534A\u5C71\u8170\u603B\u662F\u6700\u6324\u7684\uFF0C\u4F60\u5F97\u53BB\u5C71\u9876\u770B\u770B\u3002","\u54CE\u5466\uFF0C\u4E0D\u9519\u54E6\uFF01"]],[0,["\u9AD8\u624B\u8FC7\u62DB\uFF0C\u6700\u5FCC\u5FC3\u6D6E\u6C14\u8E81\u3002","\u55EF...... \u52A0\u6CB9\uFF01","\u52AA\u529B\u5427\uFF0C\u5C11\u5E74\uFF01"]]],ie={size:4};class se{constructor(e){n(this,"score",0);n(this,"grid");n(this,"gameOver",!1);n(this,"msg","");n(this,"size");n(this,"numOfMovingTiles",0);n(this,"isMoving",!1);n(this,"events");const{size:t=0,events:i={}}=T(T({},ie),e);this.size=t,this.events=i,this.grid=new N(this.size),this.addRandomTile()}reStart(){this.score=0,this.gameOver=!1,this.grid=new N(this.size),this.addRandomTile()}addRandomTile(){if(this.grid.hasAvailableCells()){const e=this.grid.randomAvailableCell(),t=Math.random()<.7?2:4,i=new d(e,t);i.show=!1,i.animationName=d.ANIMATION_APPEAR,this.grid.addTile(i),i.show=!0,this.gameOver=this.ifGameOver()}}getDirection(e){let t=new w(0,0);switch(e){case"ArrowUp":t.row=-1;break;case"ArrowDown":t.row=1;break;case"ArrowLeft":t.column=-1;break;case"ArrowRight":t.column=1;break;default:return console.error("Main Managere getDirection() should not accept key ",e),t}return t}buildTraversal(e){let t=[];for(let i=0;i<2;i++){t.push([]);for(let s=0;s<this.size;s++)t[i].push(s)}return e.row===1&&t[0].reverse(),e.column===1&&t[1].reverse(),t}move(e){if(this.isMoving){console.warn("Is Moving!");return}this.isMoving=!0;const t=this.getDirection(e),i=this.buildTraversal(t);this.moveAction(t,i),this.moveAnimation(),this.events.moveCallback&&this.events.moveCallback()}moveAction(e,t){for(let i=0;i<this.size;i++)for(let s=0;s<this.size;s++){const a=new w(t[0][i],t[1][s]);if(!this.grid.isAvailable(a)){const u=this.grid.getTileByPosition(a);u instanceof d&&this.getMoveTo(u,e)}}}getMoveTo(e,t){const i=new w(e.position.row,e.position.column);for(i.add(t);this.grid.inBound(i)&&this.grid.isAvailable(i);)i.add(t);if(this.grid.inBound(i)){const s=this.grid.getTileByPosition(i);i.row=s.leaveAt.row,i.column=s.leaveAt.column,!s.mergedOut&&!s.mergedIn&&s.value===e.value?(e.mergedOut=!0,s.mergedIn=!0):i.sub(t)}else i.sub(t);e.leaveAt=i}moveAnimation(){this.grid.tiles.forEach(e=>{e.shouldMove()?(this.numOfMovingTiles+=1,e.leaveGrid()):this.grid.newTiles.push(e)}),this.numOfMovingTiles===0&&(this.grid.newTiles=[],this.isMoving=!1)}afterMove(e){if(!e.mergedOut){const t=new d(e.leaveAt,e.value);t.mergedIn=e.mergedIn,this.grid.newTiles.push(t)}this.numOfMovingTiles-=1,this.numOfMovingTiles===0&&this.afterAllMoving()}afterAllMoving(){let e=this.grid.tiles.shift();for(;e instanceof d;)this.grid.removeTile(e),e=this.grid.tiles.shift();for(e=this.grid.newTiles.shift();e instanceof d;)this.grid.addTile(e),e=this.grid.newTiles.shift();this.grid.tiles.forEach(t=>{t.mergedIn&&(t.merge(),this.score+=t.value)}),this.addRandomTile(),this.isMoving=!1}ifGameOver(){if(this.grid.hasAvailableCells())return!1;let e=!0;return this.grid.tiles.forEach(t=>{this.canMergeToAround(t)&&(e=!1)}),e}canMergeToAround(e){const t=[[0,1],[0,-1],[1,0],[-1,0]];for(let i=0;i<4;i++){const s=new w(e.position.row+t[i][0],e.position.column+t[i][1]);if(this.grid.inBound(s)&&this.grid.getTileByPosition(s).value===e.value)return!0}return!1}onGameStatusChange(e,t){if(t){let i=te.filter(a=>a[0]<=this.score),s=Math.floor(Math.random()*2);this.msg=i.length>0?i[0][1][s]:""}else this.msg=""}}var E=(o,e)=>{const t=o.__vccOpts||o;for(const[i,s]of e)t[i]=s;return t};const oe=C({props:{tile:null},emits:["after-move"],setup(o,{emit:e}){function t(i){e("after-move",i)}return(i,s)=>(c(),A(j,{name:o.tile.animationName,onAfterLeave:s[0]||(s[0]=a=>t(o.tile))},{default:Y(()=>[U(r("div",{class:R(`tile-${o.tile.value} position-row-${o.tile.position.row} position-column-${o.tile.position.column}`)},y(o.tile.value),3),[[V,o.tile.show]])]),_:1},8,["name"]))}});var le=E(oe,[["__scopeId","data-v-0e0d5184"]]);const ne=C({props:{cell:null},setup(o){return(e,t)=>(c(),p("div",{class:R(`position-row-${o.cell.row} position-column-${o.cell.column}`)},null,2))}});var ae=E(ne,[["__scopeId","data-v-e261eb0c"]]);const b=o=>(Q("data-v-6b794140"),o=o(),W(),o),re={id:"main"},ue=b(()=>r("p",{id:"title"},"2048",-1)),ce={id:"score"},de={id:"container"},he={key:0,id:"gameOver"},ve=b(()=>r("span",null,"Try Again!",-1)),fe=[ve],me=b(()=>r("br",null,null,-1)),ge=b(()=>r("br",null,null,-1)),pe={id:"msg"},we=C({setup(o){const e=g(new se({events:{moveCallback:P,winCallback:L,loseCallback:S}}));function t(l){e.value.afterMove(l)}function i(l){return l==="ArrowUp"||l==="ArrowDown"||l==="ArrowLeft"||l==="ArrowRight"}const s=g(),a=g(),u=g(),$=g();function P(){setTimeout(function(){var l;(l=s.value)!=null&&l.paused?s.value.play():s.value&&(s.value.load(),s.value.play())},300)}function L(){setTimeout(function(){var l;(l=a.value)==null||l.play()},300)}function S(){setTimeout(function(){var l;(l=u.value)==null||l.play()},300)}function z(l){e.value.gameOver||!i(l.key)||(l.preventDefault(),e.value.move(l.key))}let D=0,B=0;return K(()=>{window.addEventListener("keyup",z),window.addEventListener("touchstart",function(l){e.value.gameOver||(l.preventDefault(),D=l.changedTouches[0].pageX,B=l.changedTouches[0].pageY)},{passive:!1}),window.addEventListener("touchmove",function(l){if(!e.value.gameOver&&(l.preventDefault(),l.changedTouches.length)){let f=l.changedTouches[0].pageX,h=l.changedTouches[0].pageY,v=f-D,m=h-B,_=100;Math.abs(v)>Math.abs(m)&&v>_?e.value.move("ArrowRight"):Math.abs(v)>Math.abs(m)&&v<-_?e.value.move("ArrowLeft"):Math.abs(m)>Math.abs(v)&&m>_?e.value.move("ArrowDown"):Math.abs(m)>Math.abs(v)&&m<-_&&e.value.move("ArrowUp")}},{passive:!1})}),H(()=>e.value.gameOver,(l,f)=>{e.value.onGameStatusChange(f,l)}),(l,f)=>(c(),p(F,null,[r("div",re,[ue,r("p",ce,"score "+y(e.value.score),1),r("div",de,[(c(!0),p(F,null,I(e.value.grid.tiles,h=>(c(),A(le,{key:h.id.toString(),tile:h,onAfterMove:v=>t(h)},null,8,["tile","onAfterMove"]))),128)),(c(!0),p(F,null,I(e.value.grid.availableCells,h=>(c(),A(ae,{cell:h},null,8,["cell"]))),256))]),e.value.gameOver?(c(),p("div",he,[r("button",{onClick:f[0]||(f[0]=h=>e.value.reStart())},fe),me,ge,r("p",pe,y(e.value.msg),1)])):J("",!0)]),r("audio",{ref_key:"clickAudioRef",ref:s,style:{display:"none"},controls:"",src:"./audio/click.mp3"},null,512),r("audio",{ref_key:"winAudioRef",ref:a,style:{display:"none"},controls:"",src:"./audio/win.mp3"},null,512),r("audio",{ref_key:"loseAudioRef",ref:u,style:{display:"none"},controls:"",src:"./audio/lose.mp3"},null,512),r("audio",{ref_key:"welAudioRef",ref:$,style:{display:"none"},controls:"",src:"./audio/welcome.mp3"},null,512)],64))}});var _e=E(we,[["__scopeId","data-v-6b794140"]]);const Ae=C({setup(o){return(e,t)=>(c(),A(_e))}});Z(Ae).mount("#app");
