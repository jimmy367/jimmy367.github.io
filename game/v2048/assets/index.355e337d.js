var O=Object.defineProperty;var C=(o,e,t)=>e in o?O(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var n=(o,e,t)=>(C(o,typeof e!="symbol"?e+"":e,t),t);import{G as y,d as f,o as a,c as m,w as I,T as N,a as $,v as P,b as h,t as M,n as T,e as d,r as k,f as B,F as w,g as _,h as x,p as z,i as E,j as L}from"./vendor.483e7612.js";const R=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerpolicy&&(r.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?r.credentials="include":s.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}};R();class v{constructor(e,t){n(this,"row");n(this,"column");this.row=e,this.column=t}toString(){return`tile-position-${this.row}-${this.column}`}equal(e){return this.row===e.row&&this.column===e.column}add(e){this.row+=e.row,this.column+=e.column}sub(e){this.row-=e.row,this.column-=e.column}}class A{constructor(e){n(this,"size");n(this,"tiles",[]);n(this,"availableCells",[]);n(this,"newTiles",[]);this.size=e;for(let t=0;t<e;t++)for(let i=0;i<e;i++)this.availableCells.push(new v(t,i))}inBound(e){return e.row>=0&&e.row<this.size&&e.column>=0&&e.column<this.size}addTile(e){this.tiles.push(e),this.availableCells=this.availableCells.filter(t=>!t.equal(e.position))}removeTile(e){this.tiles=this.tiles.filter(t=>t.id!==e.id),this.availableCells.push(e.position)}isAvailable(e){for(let t=0;t<this.availableCells.length;t++)if(this.availableCells[t].equal(e))return!0;return!1}getTileByPosition(e){return this.tiles.filter(t=>t.position.equal(e))[0]}randomAvailableCell(){return this.availableCells[Math.floor(Math.random()*this.availableCells.length)]}hasAvailableCells(){return this.availableCells.length>0}}const p=class{constructor(e,t){n(this,"id");n(this,"value");n(this,"mergedOut");n(this,"mergedIn");n(this,"show");n(this,"animationName");n(this,"position");n(this,"leaveAt");this.id=y.create().toString(),this.value=t,this.mergedOut=!1,this.mergedIn=!1,this.show=!0,this.animationName=p.ANIMATION_NONE,this.position=e,this.leaveAt=e}shouldMove(){return!this.position.equal(this.leaveAt)}leaveGrid(){this.position.row!==this.leaveAt.row&&(this.animationName=`row-from-${this.position.row}-to-${this.leaveAt.row}`),this.position.column!==this.leaveAt.column&&(this.animationName=`column-from-${this.position.column}-to-${this.leaveAt.column}`),this.show=!1}merge(){this.mergedIn=!1,this.value*=2}};let u=p;n(u,"ANIMATION_NONE",""),n(u,"ANIMATION_APPEAR","appear");class S{constructor(e=4){n(this,"size");n(this,"score",0);n(this,"grid");n(this,"gameOver",!1);n(this,"numOfMovingTiles",0);n(this,"isMoving",!1);this.size=e,this.grid=new A(this.size),this.addRandomTile()}setup(){this.score=0,this.gameOver=!1,this.grid=new A(this.size),this.addRandomTile()}addRandomTile(){if(this.grid.hasAvailableCells()){const e=this.grid.randomAvailableCell(),t=Math.random()<.7?2:4,i=new u(e,t);i.show=!1,i.animationName=u.ANIMATION_APPEAR,this.grid.addTile(i),i.show=!0,this.gameOver=this.ifGameOver()}}getDirection(e){let t=new v(0,0);switch(e){case"ArrowUp":t.row=-1;break;case"ArrowDown":t.row=1;break;case"ArrowLeft":t.column=-1;break;case"ArrowRight":t.column=1;break;default:return console.error("Main Managere getDirection() should not accept key ",e),t}return t}buildTraversal(e){let t=[];for(let i=0;i<2;i++){t.push([]);for(let s=0;s<this.size;s++)t[i].push(s)}return e.row===1&&t[0].reverse(),e.column===1&&t[1].reverse(),t}move(e){if(this.isMoving){console.warn("Is Moving!");return}this.isMoving=!0;const t=this.getDirection(e),i=this.buildTraversal(t);this.moveAction(t,i),this.moveAnimation()}moveAction(e,t){for(let i=0;i<this.size;i++)for(let s=0;s<this.size;s++){const r=new v(t[0][i],t[1][s]);if(!this.grid.isAvailable(r)){const l=this.grid.getTileByPosition(r);l instanceof u&&this.getMoveTo(l,e)}}}getMoveTo(e,t){const i=new v(e.position.row,e.position.column);for(i.add(t);this.grid.inBound(i)&&this.grid.isAvailable(i);)i.add(t);if(this.grid.inBound(i)){const s=this.grid.getTileByPosition(i);i.row=s.leaveAt.row,i.column=s.leaveAt.column,!s.mergedOut&&!s.mergedIn&&s.value===e.value?(e.mergedOut=!0,s.mergedIn=!0):i.sub(t)}else i.sub(t);e.leaveAt=i}moveAnimation(){this.grid.tiles.forEach(e=>{e.shouldMove()?(this.numOfMovingTiles+=1,e.leaveGrid()):this.grid.newTiles.push(e)}),this.numOfMovingTiles===0&&(this.grid.newTiles=[],this.isMoving=!1)}afterMove(e){if(!e.mergedOut){const t=new u(e.leaveAt,e.value);t.mergedIn=e.mergedIn,this.grid.newTiles.push(t)}this.numOfMovingTiles-=1,this.numOfMovingTiles===0&&this.afterAllMoving()}afterAllMoving(){let e=this.grid.tiles.shift();for(;e instanceof u;)this.grid.removeTile(e),e=this.grid.tiles.shift();for(e=this.grid.newTiles.shift();e instanceof u;)this.grid.addTile(e),e=this.grid.newTiles.shift();this.grid.tiles.forEach(t=>{t.mergedIn&&(t.merge(),this.score+=t.value)}),this.addRandomTile(),this.isMoving=!1}ifGameOver(){if(this.grid.hasAvailableCells())return!1;let e=!0;return this.grid.tiles.forEach(t=>{this.canMergeToAround(t)&&(e=!1)}),e}canMergeToAround(e){const t=[[0,1],[0,-1],[1,0],[-1,0]];for(let i=0;i<4;i++){const s=new v(e.position.row+t[i][0],e.position.column+t[i][1]);if(this.grid.inBound(s)&&this.grid.getTileByPosition(s).value===e.value)return!0}return!1}}var g=(o,e)=>{const t=o.__vccOpts||o;for(const[i,s]of e)t[i]=s;return t};const D=f({props:{tile:null},emits:["after-move"],setup(o,{emit:e}){function t(i){e("after-move",i)}return(i,s)=>(a(),m(N,{name:o.tile.animationName,onAfterLeave:s[0]||(s[0]=r=>t(o.tile))},{default:I(()=>[$(h("div",{class:T(`tile-${o.tile.value} position-row-${o.tile.position.row} position-column-${o.tile.position.column}`)},M(o.tile.value),3),[[P,o.tile.show]])]),_:1},8,["name"]))}});var G=g(D,[["__scopeId","data-v-1291d475"]]);const q=f({props:{cell:null},setup(o){return(e,t)=>(a(),d("div",{class:T(`position-row-${o.cell.row} position-column-${o.cell.column}`)},null,2))}});var j=g(q,[["__scopeId","data-v-288e2fed"]]);const b=o=>(z("data-v-6b8c176e"),o=o(),E(),o),F=b(()=>h("p",{id:"title"},"2048",-1)),K={id:"score"},U={id:"container"},V={key:0,id:"gameOver"},H=b(()=>h("span",null,"Restart ",-1)),J=[H],Q=f({setup(o){const e=k(new S);function t(r){e.value.afterMove(r)}function i(r){return r==="ArrowUp"||r==="ArrowDown"||r==="ArrowLeft"||r==="ArrowRight"}function s(r){e.value.gameOver||!i(r.key)||(r.preventDefault(),e.value.move(r.key))}return B(()=>{window.addEventListener("keyup",s)}),(r,l)=>(a(),d("div",null,[F,h("p",K,"score "+M(e.value.score),1),h("div",U,[(a(!0),d(w,null,_(e.value.grid.tiles,c=>(a(),m(G,{key:c.id.toString(),tile:c,onAfterMove:Y=>t(c)},null,8,["tile","onAfterMove"]))),128)),(a(!0),d(w,null,_(e.value.grid.availableCells,c=>(a(),m(j,{cell:c},null,8,["cell"]))),256))]),e.value.gameOver?(a(),d("div",V,[h("button",{onClick:l[0]||(l[0]=c=>e.value.setup())},J)])):x("",!0)]))}});var W=g(Q,[["__scopeId","data-v-6b8c176e"]]);const X=f({setup(o){return(e,t)=>(a(),m(W))}});L(X).mount("#app");
