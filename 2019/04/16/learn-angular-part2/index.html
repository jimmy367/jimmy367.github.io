<!DOCTYPE html><html lang="en"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="（二）使用 Angular CLI 创建 Todo App"><meta name="keywords" content="angular,前端"><meta name="author" content="jimmy367"><meta name="copyright" content="jimmy367"><title>（二）使用 Angular CLI 创建 Todo App | Jimmy's Blog</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.6.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.6.1"><link rel="dns-prefetch" href="https://cdn.staticfile.org"><link rel="dns-prefetch" href="https://cdn.bootcss.com"><link rel="dns-prefetch" href="https://creativecommons.org"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js"></script><link rel="manifest" href="/manifest.json"><link rel="manifest" href="/manifest.json"><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle = window.adsbygoogle || []).push({
  google_ad_client: 'ca-pub-5495475741837597',
  enable_page_level_ads: 'true'
});
</script><link rel="dns-prefetch" href="https://hm.baidu.com"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?1b0a25eb534062be92a275b1e928fd03";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();</script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#使用-AngularCLI-初始化-Todo-应用程序"><span class="toc-text">使用 AngularCLI 初始化 Todo 应用程序</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#创建Todo类"><span class="toc-text">创建Todo类</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#创建-TodoDataService-服务"><span class="toc-text">创建 TodoDataService 服务</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#编辑-AppComponent-组件"><span class="toc-text">编辑 AppComponent 组件</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="http://static.ohtudou.cc/static/images/avatar1.jpg?2022101001"></div><div class="author-info__name text-center">jimmy367</div><div class="author-info__description text-center">技术分享博客</div><div class="follow-button"><a href="https://github.com/jimmy367">Follo Me</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">28</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">44</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">20</span></a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(http://static.ohtudou.cc/static/images/top1.jpg?2022101002)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Jimmy's Blog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> Search</span></a><a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a><a class="site-page" href="/gallery">Gallery</a><a class="site-page" href="/game">Game</a></span></div><div id="post-info"><div id="post-title">（二）使用 Angular CLI 创建 Todo App</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-04-16</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Web/">Web</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Web/开发/">开发</a><div class="post-meta-wordcount"><span>Word count: </span><span class="word-count">3.5k</span><span class="post-meta__separator">|</span><span>Reading time: 19 min</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><img src="http://static.ohtudou.cc/static/images/learn-angular-part2-1.png?imageView2/2/w/1000">
<p>在本篇文章中，我们将学会：</p>
<ul>
<li>使用 AngularCLI 初始化 Todo 应用程序</li>
<li>创建代表个人待办事项的 Todo 类</li>
<li>创建 TodoDataService 服务，用来创建，更新和删除待办事项</li>
<li>使用 AppComponent 组件显示用户界面</li>
</ul>
<a id="more"></a>
<p>我们的应用程序架构会像这样：<br><img src="http://static.ohtudou.cc/static/images/learn-angular-part2-2.png"><br>本文将讨论标有红色边框的项目，以外的部分会在后续文章中说明。</p>
<h1 id="使用-AngularCLI-初始化-Todo-应用程序"><a href="#使用-AngularCLI-初始化-Todo-应用程序" class="headerlink" title="使用 AngularCLI 初始化 Todo 应用程序"></a>使用 AngularCLI 初始化 Todo 应用程序</h1><hr>
<p>安装 Angular CLI，在命令行中运行以下命令：</p>
<blockquote>
<p>$ npm install -g @angular/cli</p>
</blockquote>
<p>这将会在系统全局安装 ng 命令</p>
<p>验证是否成功安装 Angular CLI，可在命令行运行：</p>
<blockquote>
<p>$ ng version</p>
</blockquote>
<p>在我本机运行上述命令，则输出以下结果：</p>
<blockquote>
<p>Angular CLI: 7.3.7<br>Node: 10.15.0<br>OS: win32 x64<br>Angular:<br>…</p>
</blockquote>
<p>那么你已经成功安装Angular CLI了，现在你可以用它来创建Todo应用：</p>
<blockquote>
<p>$ ng new todo-app</p>
</blockquote>
<p>新的 todo-app 目录被创建，应用程序的目录结构如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">todo-app</span><br><span class="line">│  angular.json</span><br><span class="line">│  package-lock.json</span><br><span class="line">│  package.json</span><br><span class="line">│  README.md</span><br><span class="line">│  tsconfig.json</span><br><span class="line">│  tslint.json</span><br><span class="line">│  </span><br><span class="line">├─e2e</span><br><span class="line">│  │  protractor.conf.js</span><br><span class="line">│  │  tsconfig.e2e.json</span><br><span class="line">│  └─src</span><br><span class="line">│          app.e2e-spec.ts</span><br><span class="line">│          app.po.ts              </span><br><span class="line">└─src</span><br><span class="line">    │  browserslist</span><br><span class="line">    │  favicon.ico</span><br><span class="line">    │  index.html</span><br><span class="line">    │  karma.conf.js</span><br><span class="line">    │  main.ts</span><br><span class="line">    │  polyfills.ts</span><br><span class="line">    │  styles.css</span><br><span class="line">    │  test.ts</span><br><span class="line">    │  tsconfig.app.json</span><br><span class="line">    │  tsconfig.spec.json</span><br><span class="line">    │  tslint.json</span><br><span class="line">    │  </span><br><span class="line">    ├─app</span><br><span class="line">    │      app-routing.module.ts</span><br><span class="line">    │      app.component.css</span><br><span class="line">    │      app.component.html</span><br><span class="line">    │      app.component.spec.ts</span><br><span class="line">    │      app.component.ts</span><br><span class="line">    │      app.module.ts</span><br><span class="line">    │      </span><br><span class="line">    ├─assets</span><br><span class="line">    │      </span><br><span class="line">    └─environments</span><br><span class="line">            environment.prod.ts</span><br><span class="line">            environment.ts</span><br></pre></td></tr></table></figure></p>
<p>你可以进入新生成的目录：</p>
<blockquote>
<p>$ cd todo-app</p>
</blockquote>
<p>启动Angular CLI开发服务器：</p>
<blockquote>
<p>$ ng serve</p>
</blockquote>
<p>这将会启动本地开发服务器，可以在浏览器中输入以下URL访问：</p>
<blockquote>
<p><a href="http://localhost:4200/" target="_blank" rel="noopener">http://localhost:4200/</a></p>
</blockquote>
<p>Angular CLI开发服务器支持LiveReload，修改的代码将会自动reload，反映到画面上。</p>
<p>这真是太方便了！</p>
<h1 id="创建Todo类"><a href="#创建Todo类" class="headerlink" title="创建Todo类"></a>创建Todo类</h1><hr>
<p>让我们使用Angular CLI创建Todo类：</p>
<blockquote>
<p>ng g class Todo</p>
</blockquote>
<p>这将会创建以下文件：</p>
<blockquote>
<p>src/app/todo.spec.ts<br>src/app/todo.ts</p>
</blockquote>
<p>打开 src/app/todo.ts<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export class Todo &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>修改如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">export class Todo &#123;</span><br><span class="line">  id: number;</span><br><span class="line">  title: string = &apos;&apos;;</span><br><span class="line">  complete: boolean = false;</span><br><span class="line"></span><br><span class="line">  constructor(values: Object = &#123;&#125;) &#123;</span><br><span class="line">    Object.assign(this, values);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>在这个类定义里面，我们为每个Todo实例声名三个属性</p>
<ul>
<li>id: number, 代办项目的唯一ID</li>
<li>title: string, 代办项目的标题</li>
<li>complete: boolean, 该代办项目是否完了</li>
</ul>
<p>我们还定义了一个构造函数，可以很容易的像以下这样得到Todo的实例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">let todo = new Todo(&#123;</span><br><span class="line">  title: &apos;Read SitePoint article&apos;,</span><br><span class="line">  complete: false</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>再来看一下测试类：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Todo &#125; from &apos;./todo&apos;;</span><br><span class="line"></span><br><span class="line">describe(&apos;Todo&apos;, () =&gt; &#123;</span><br><span class="line">  it(&apos;should create an instance&apos;, () =&gt; &#123;</span><br><span class="line">    expect(new Todo()).toBeTruthy();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>让我们添加一些测试用例来验证构造函数是否正常工作<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">import &#123;Todo&#125; from &apos;./todo&apos;;</span><br><span class="line"></span><br><span class="line">describe(&apos;Todo&apos;, () =&gt; &#123;</span><br><span class="line">  it(&apos;should create an instance&apos;, () =&gt; &#123;</span><br><span class="line">    expect(new Todo()).toBeTruthy();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  it(&apos;should accept values in the constructor&apos;, () =&gt; &#123;</span><br><span class="line">    let todo = new Todo(&#123;</span><br><span class="line">      title: &apos;hello&apos;,</span><br><span class="line">      complete: true</span><br><span class="line">    &#125;);</span><br><span class="line">    expect(todo.title).toEqual(&apos;hello&apos;);</span><br><span class="line">    expect(todo.complete).toEqual(true);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>运行测试：</p>
<blockquote>
<p>$ ng test</p>
</blockquote>
<p>这将会调用 Karma test runner 运行所有单元测试。结果如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> 11% building 13/13 modules 0 active19 04 2019 10:57:09.848:WARN [karma]: No captured browser, open http://localhost:9876/</span><br><span class="line">19 04 2019 10:57:09.855:INFO [karma-server]: Karma v4.0.1 server started at http://0.0.0.0:9876/</span><br><span class="line">19 04 2019 10:57:09.856:INFO [launcher]: Launching browsers Chrome with concurrency unlimited</span><br><span class="line">19 04 2019 10:57:09.862:INFO [launcher]: Starting browser Chrome                                                                                                                        19 04 2019 10:57:14.044:WARN [karma]: No captured browser, open http://localhost:9876/</span><br><span class="line">19 04 2019 10:57:14.097:INFO [Chrome 73.0.3683 (Windows 10.0.0)]: Connected on socket 417UpstoOGPuv9eNAAAA with id 87200179</span><br><span class="line">Chrome 73.0.3683 (Windows 10.0.0): Executed 5 of 5 SUCCESS (0.117 secs / 0.163 secs)</span><br><span class="line">TOTAL: 5 SUCCESS</span><br><span class="line">TOTAL: 5 SUCCESS</span><br></pre></td></tr></table></figure></p>
<h1 id="创建-TodoDataService-服务"><a href="#创建-TodoDataService-服务" class="headerlink" title="创建 TodoDataService 服务"></a>创建 TodoDataService 服务</h1><hr>
<p>TodoDataService 用来管理代办项目。<br>以后我们将会学习如何使用REST API，现在我们把数据直接定义在内存中。</p>
<p>创建服务：</p>
<blockquote>
<p>ng g service TodoData</p>
</blockquote>
<p>输出如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CREATE src/app/todo-data.service.spec.ts (344 bytes)</span><br><span class="line">CREATE src/app/todo-data.service.ts (137 bytes)</span><br></pre></td></tr></table></figure></p>
<p>TodoDataService 的代码如下<br>src/app/todo-data.service.ts<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Injectable &#125; from &apos;@angular/core&apos;;</span><br><span class="line"></span><br><span class="line">@Injectable(&#123;</span><br><span class="line">  providedIn: &apos;root&apos;</span><br><span class="line">&#125;)</span><br><span class="line">export class TodoDataService &#123;</span><br><span class="line"></span><br><span class="line">  constructor() &#123; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>单元测试用的代码如下<br>src/app/todo-data.service.spec.ts<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">import &#123; TestBed &#125; from &apos;@angular/core/testing&apos;;</span><br><span class="line"></span><br><span class="line">import &#123; TodoDataService &#125; from &apos;./todo-data.service&apos;;</span><br><span class="line"></span><br><span class="line">describe(&apos;TodoDataService&apos;, () =&gt; &#123;</span><br><span class="line">  beforeEach(() =&gt; TestBed.configureTestingModule(&#123;&#125;));</span><br><span class="line"></span><br><span class="line">  it(&apos;should be created&apos;, () =&gt; &#123;</span><br><span class="line">    const service: TodoDataService = TestBed.get(TodoDataService);</span><br><span class="line">    expect(service).toBeTruthy();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>打开src/app/todo-data.service.ts，修改TodoDataService如下：<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Injectable &#125; <span class="keyword">from</span> <span class="string">'@angular/core'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;Todo&#125; <span class="keyword">from</span> <span class="string">'./todo'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Injectable</span>(&#123;</span><br><span class="line">  providedIn: <span class="string">'root'</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> TodoDataService &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Placeholder for last id so we can simulate</span></span><br><span class="line">  <span class="comment">// automatic incrementing of ids</span></span><br><span class="line">  lastId: <span class="built_in">number</span> = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Placeholder for todos</span></span><br><span class="line">  todos: Todo[] = [];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params"></span>) &#123; &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Simulate POST /todos</span></span><br><span class="line">  addTodo(todo: Todo): TodoDataService &#123;</span><br><span class="line">    <span class="keyword">if</span> (!todo.id) &#123;</span><br><span class="line">      todo.id = ++<span class="keyword">this</span>.lastId;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.todos.push(todo);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Simulate DELETE /todos/:id</span></span><br><span class="line">  deleteTodoById(id: <span class="built_in">number</span>): TodoDataService &#123;</span><br><span class="line">    <span class="keyword">this</span>.todos = <span class="keyword">this</span>.todos.filter(<span class="function"><span class="params">todo</span> =&gt;</span> todo.id !== id);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Simulate PUT /todos/:id</span></span><br><span class="line">  updateTodoById(id: <span class="built_in">number</span>, values: <span class="built_in">Object</span> = &#123;&#125;): Todo &#123;</span><br><span class="line">    <span class="keyword">let</span> todo = <span class="keyword">this</span>.getTodoById(id);</span><br><span class="line">    <span class="keyword">if</span> (!todo) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">Object</span>.assign(todo, values);</span><br><span class="line">    <span class="keyword">return</span> todo;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Simulate GET /todos</span></span><br><span class="line">  getAllTodos(): Todo[] &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.todos;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Simulate GET /todos/:id</span></span><br><span class="line">  getTodoById(id: <span class="built_in">number</span>): Todo &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.todos.filter(<span class="function"><span class="params">todo</span> =&gt;</span> todo.id === id).pop();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Toggle todo complete</span></span><br><span class="line">  toggleTodoComplete(todo: Todo)&#123;</span><br><span class="line">    <span class="keyword">let</span> updatedTodo = <span class="keyword">this</span>.updateTodoById(todo.id, &#123;</span><br><span class="line">      complete: !todo.complete</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> updatedTodo;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>打开src/app/todo-data.service.spec.ts，添加单元测试用例：<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; TestBed &#125; <span class="keyword">from</span> <span class="string">'@angular/core/testing'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;Todo&#125; <span class="keyword">from</span> <span class="string">'./todo'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; TodoDataService &#125; <span class="keyword">from</span> <span class="string">'./todo-data.service'</span>;</span><br><span class="line"></span><br><span class="line">describe(<span class="string">'TodoDataService'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  beforeEach(<span class="function"><span class="params">()</span> =&gt;</span> TestBed.configureTestingModule(&#123;&#125;));</span><br><span class="line"></span><br><span class="line">  it(<span class="string">'should be created'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> service: TodoDataService = TestBed.get(TodoDataService);</span><br><span class="line">    expect(service).toBeTruthy();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  describe(<span class="string">'#getAllTodos()'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    it(<span class="string">'should return an empty array by default'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> service: TodoDataService = TestBed.get(TodoDataService);</span><br><span class="line">      expect(service.getAllTodos()).toEqual([]);</span><br><span class="line">    &#125;);</span><br><span class="line">    it(<span class="string">'should return all todos'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> service: TodoDataService = TestBed.get(TodoDataService);</span><br><span class="line">      <span class="keyword">let</span> todo1 = <span class="keyword">new</span> Todo(&#123;title: <span class="string">'Hello 1'</span>, complete: <span class="literal">false</span>&#125;);</span><br><span class="line">      <span class="keyword">let</span> todo2 = <span class="keyword">new</span> Todo(&#123;title: <span class="string">'Hello 2'</span>, complete: <span class="literal">true</span>&#125;);</span><br><span class="line">      service.addTodo(todo1);</span><br><span class="line">      service.addTodo(todo2);</span><br><span class="line">      expect(service.getAllTodos()).toEqual([todo1, todo2]);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  describe(<span class="string">'#save(todo)'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    it(<span class="string">'should automatically assign an incrementing id'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> service: TodoDataService = TestBed.get(TodoDataService);</span><br><span class="line">      <span class="keyword">let</span> todo1 = <span class="keyword">new</span> Todo(&#123;title: <span class="string">'Hello 1'</span>, complete: <span class="literal">false</span>&#125;);</span><br><span class="line">      <span class="keyword">let</span> todo2 = <span class="keyword">new</span> Todo(&#123;title: <span class="string">'Hello 2'</span>, complete: <span class="literal">true</span>&#125;);</span><br><span class="line">      service.addTodo(todo1);</span><br><span class="line">      service.addTodo(todo2);</span><br><span class="line">      expect(service.getTodoById(<span class="number">1</span>)).toEqual(todo1);</span><br><span class="line">      expect(service.getTodoById(<span class="number">2</span>)).toEqual(todo2);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  describe(<span class="string">'#deleteTodoById(id)'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    it(<span class="string">'should remove todo with the corresponding id'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> service: TodoDataService = TestBed.get(TodoDataService);</span><br><span class="line">      <span class="keyword">let</span> todo1 = <span class="keyword">new</span> Todo(&#123;title: <span class="string">'Hello 1'</span>, complete: <span class="literal">false</span>&#125;);</span><br><span class="line">      <span class="keyword">let</span> todo2 = <span class="keyword">new</span> Todo(&#123;title: <span class="string">'Hello 2'</span>, complete: <span class="literal">true</span>&#125;);</span><br><span class="line">      service.addTodo(todo1);</span><br><span class="line">      service.addTodo(todo2);</span><br><span class="line">      expect(service.getAllTodos()).toEqual([todo1, todo2]);</span><br><span class="line">      service.deleteTodoById(<span class="number">1</span>);</span><br><span class="line">      expect(service.getAllTodos()).toEqual([todo2]);</span><br><span class="line">      service.deleteTodoById(<span class="number">2</span>);</span><br><span class="line">      expect(service.getAllTodos()).toEqual([]);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    it(<span class="string">'should not removing anything if todo with corresponding id is not found'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> service: TodoDataService = TestBed.get(TodoDataService);</span><br><span class="line">      <span class="keyword">let</span> todo1 = <span class="keyword">new</span> Todo(&#123;title: <span class="string">'Hello 1'</span>, complete: <span class="literal">false</span>&#125;);</span><br><span class="line">      <span class="keyword">let</span> todo2 = <span class="keyword">new</span> Todo(&#123;title: <span class="string">'Hello 2'</span>, complete: <span class="literal">true</span>&#125;);</span><br><span class="line">      service.addTodo(todo1);</span><br><span class="line">      service.addTodo(todo2);</span><br><span class="line">      expect(service.getAllTodos()).toEqual([todo1, todo2]);</span><br><span class="line">      service.deleteTodoById(<span class="number">3</span>);</span><br><span class="line">      expect(service.getAllTodos()).toEqual([todo1, todo2]);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  describe(<span class="string">'#updateTodoById(id, values)'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    it(<span class="string">'should return todo with the corresponding id and updated data'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> service: TodoDataService = TestBed.get(TodoDataService);</span><br><span class="line">      <span class="keyword">let</span> todo = <span class="keyword">new</span> Todo(&#123;title: <span class="string">'Hello 1'</span>, complete: <span class="literal">false</span>&#125;);</span><br><span class="line">      service.addTodo(todo);</span><br><span class="line">      <span class="keyword">let</span> updatedTodo = service.updateTodoById(<span class="number">1</span>, &#123;</span><br><span class="line">        title: <span class="string">'new title'</span></span><br><span class="line">      &#125;);</span><br><span class="line">      expect(updatedTodo.title).toEqual(<span class="string">'new title'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    it(<span class="string">'should return null if todo is not found'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> service: TodoDataService = TestBed.get(TodoDataService);</span><br><span class="line">      <span class="keyword">let</span> todo = <span class="keyword">new</span> Todo(&#123;title: <span class="string">'Hello 1'</span>, complete: <span class="literal">false</span>&#125;);</span><br><span class="line">      service.addTodo(todo);</span><br><span class="line">      <span class="keyword">let</span> updatedTodo = service.updateTodoById(<span class="number">2</span>, &#123;</span><br><span class="line">        title: <span class="string">'new title'</span></span><br><span class="line">      &#125;);</span><br><span class="line">      expect(updatedTodo).toEqual(<span class="literal">null</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  describe(<span class="string">'#toggleTodoComplete(todo)'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    it(<span class="string">'should return the updated todo with inverse complete status'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> service: TodoDataService = TestBed.get(TodoDataService);</span><br><span class="line">      <span class="keyword">let</span> todo = <span class="keyword">new</span> Todo(&#123;title: <span class="string">'Hello 1'</span>, complete: <span class="literal">false</span>&#125;);</span><br><span class="line">      service.addTodo(todo);</span><br><span class="line">      <span class="keyword">let</span> updatedTodo = service.toggleTodoComplete(todo);</span><br><span class="line">      expect(updatedTodo.complete).toEqual(<span class="literal">true</span>);</span><br><span class="line">      service.toggleTodoComplete(todo);</span><br><span class="line">      expect(updatedTodo.complete).toEqual(<span class="literal">false</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">  </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>运行测试：</p>
<blockquote>
<p>$ ng test</p>
</blockquote>
<p>结果如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> 11% building 12/12 modules 0 active19 04 2019 11:45:20.342:WARN [karma]: No captured browser, open http://localhost:9876/</span><br><span class="line">19 04 2019 11:45:20.350:INFO [karma-server]: Karma v4.0.1 server started at http://0.0.0.0:9876/</span><br><span class="line">19 04 2019 11:45:20.351:INFO [launcher]: Launching browsers Chrome with concurrency unlimited                                                                                                   11% building 15/15 modules 0 active19 04 2019 11:45:20.378:INFO [launcher]: Starting browser Chrome                                                                                                                               19 04 2019 11:45:24.851:WARN [karma]: No captured browser, open http://localhost:9876/</span><br><span class="line">19 04 2019 11:45:24.902:INFO [Chrome 73.0.3683 (Windows 10.0.0)]: Connected on socket 8KiTWeIsmEK4BogfAAAA with id 63883826</span><br><span class="line">Chrome 73.0.3683 (Windows 10.0.0): Executed 14 of 14 SUCCESS (0.119 secs / 0.236 secs)</span><br><span class="line">TOTAL: 14 SUCCESS</span><br><span class="line">TOTAL: 14 SUCCESS</span><br></pre></td></tr></table></figure></p>
<h1 id="编辑-AppComponent-组件"><a href="#编辑-AppComponent-组件" class="headerlink" title="编辑 AppComponent 组件"></a>编辑 AppComponent 组件</h1><hr>
<p>当我们初始化Todo应用程序的时候，Angular CLI 自动生成 AppComponent 组件：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">src/app/app.component.css</span><br><span class="line">src/app/app.component.html</span><br><span class="line">src/app/app.component.spec.ts</span><br><span class="line">src/app/app.component.ts</span><br></pre></td></tr></table></figure></p>
<p>打开src/app/app.component.html，更新成如下内容：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;section class=&quot;todoapp&quot;&gt;</span><br><span class="line">  &lt;header class=&quot;header&quot;&gt;</span><br><span class="line">    &lt;h1&gt;Todos&lt;/h1&gt;</span><br><span class="line">    &lt;input class=&quot;new-todo&quot; placeholder=&quot;What needs to be done?&quot; autofocus=&quot;&quot; [(ngModel)]=&quot;newTodo.title&quot; (keyup.enter)=&quot;addTodo()&quot;&gt;</span><br><span class="line">  &lt;/header&gt;</span><br><span class="line">  &lt;section class=&quot;main&quot; *ngIf=&quot;todos.length &gt; 0&quot;&gt;</span><br><span class="line">    &lt;ul class=&quot;todo-list&quot;&gt;</span><br><span class="line">      &lt;li *ngFor=&quot;let todo of todos&quot; [class.completed]=&quot;todo.complete&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;view&quot;&gt;</span><br><span class="line">          &lt;input class=&quot;toggle&quot; type=&quot;checkbox&quot; (click)=&quot;toggleTodoComplete(todo)&quot; [checked]=&quot;todo.complete&quot;&gt;</span><br><span class="line">          &lt;label&gt;&#123;&#123;todo.title&#125;&#125;&lt;/label&gt;</span><br><span class="line">          &lt;button class=&quot;destroy&quot; (click)=&quot;removeTodo(todo)&quot;&gt;&lt;/button&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/li&gt;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">  &lt;/section&gt;</span><br><span class="line">  &lt;footer class=&quot;footer&quot; *ngIf=&quot;todos.length &gt; 0&quot;&gt;</span><br><span class="line">    &lt;span class=&quot;todo-count&quot;&gt;&lt;strong&gt;&#123;&#123;todos.length&#125;&#125;&lt;/strong&gt; &#123;&#123;todos.length == 1 ? &apos;item&apos; : &apos;items&apos;&#125;&#125; left&lt;/span&gt;</span><br><span class="line">  &lt;/footer&gt;</span><br><span class="line">&lt;/section&gt;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>[property]=”expression”:set property of an element to the value of expression</li>
<li>(event)=”statement”: execute statement when event occurred</li>
<li>[(property)]=”expression”: create two-way binding with expression</li>
<li>[class.special]=”expression”: add special CSS class to element when the value of expression is truthy</li>
<li>[style.color]=”expression”: set color CSS property to the value of expression<br><em>英文原文更贴切</em></li>
</ul>
<p>让我们来看一下代码的含义：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">"new-todo"</span> <span class="attr">placeholder</span>=<span class="string">"What needs to be done?"</span> <span class="attr">autofocus</span>=<span class="string">""</span> [(<span class="attr">ngModel</span>)]=<span class="string">"newTodo.title"</span> (<span class="attr">keyup.enter</span>)=<span class="string">"addTodo()"</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<ul>
<li>[(ngModel)]=”newTodo.title”: adds a two-way binding between the input value and newTodo.title<br><em>需要在app.module.ts中引入FormsModule</em></li>
<li>(keyup.enter)=”addTodo()”: tells Angular to execute addTodo() when the enter key was pressed while typing in the input element</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">"main"</span> *<span class="attr">ngIf</span>=<span class="string">"todos.length &gt; 0"</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>*ngIf=”todos.length &gt; 0”: only show the section element and all its children when there is at least one todo</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span> *<span class="attr">ngFor</span>=<span class="string">"let todo of todos"</span> [<span class="attr">class.completed</span>]=<span class="string">"todo.complete"</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>*ngFor=”let todo of todos”: loop over all todos and assign current todo to a variable called todo for each iteration</li>
<li>[class.completed]=”todo.complete”: apply CSS class completed to li element when todo.complete is truthy</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"view"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">"toggle"</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> (<span class="attr">click</span>)=<span class="string">"toggleTodoComplete(todo)"</span> [<span class="attr">checked</span>]=<span class="string">"todo.complete"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">label</span>&gt;</span><span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"destroy"</span> (<span class="attr">click</span>)=<span class="string">"removeTodo(todo)"</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>(click)=”toggleTodoComplete(todo)”: execute toggleTodoComplete(todo) when the checkbox is clicked</li>
<li>[checked]=”todo.complete”: assign the value of todo.complete to the property checked of the element</li>
<li>(click)=”removeTodo(todo)”: execute removeTodo(todo) when the destroy button is clicked</li>
</ul>
<p>组件类AppComponent定义在src/app/app.component.ts<br>Angular CLI 已经自动生成了一些基本代码：<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Component &#125; <span class="keyword">from</span> <span class="string">'@angular/core'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span>(&#123;</span><br><span class="line">  selector: <span class="string">'app-root'</span>,</span><br><span class="line">  templateUrl: <span class="string">'./app.component.html'</span>,</span><br><span class="line">  styleUrls: [<span class="string">'./app.component.css'</span>]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> AppComponent &#123;</span><br><span class="line">  title = <span class="string">'todo-app'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>我们可以加入我们自己的逻辑。</p>
<p>我们需要在AppComponent注入TodoDataService服务<br>首先引入TodoDataService并在Component注解里的providers数组里声明<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Import class so we can register it as dependency injection token</span></span><br><span class="line"><span class="keyword">import</span> &#123;TodoDataService&#125; <span class="keyword">from</span> <span class="string">'./todo-data.service'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span>(&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  providers: [TodoDataService]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> AppComponent &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>The AppComponent’s dependency injector will now recognize the TodoDataService class as a dependency injection token and return a single instance of TodoDataService when we ask for it. </p>
<p>Angular’s dependency injection system accepts a variety of dependency injection recipes. The syntax above is a shorthand notation for the Class provider recipe that provides dependencies using the singleton pattern. Check out <a href="https://angular.io/docs/ts/latest/guide/dependency-injection.html" target="_blank" rel="noopener">Angular’s dependency injection documentation</a> for more details.</p>
<p>Now that the components dependency injector knows what it needs to provide, we ask it to inject the TodoDataService instance in our component by specifying the dependency in the AppComponent constructor:</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Import class so we can use it as dependency injection token in the constructor</span></span><br><span class="line"><span class="keyword">import</span> &#123;TodoDataService&#125; <span class="keyword">from</span> <span class="string">'./todo-data.service'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span>(&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> AppComponent &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Ask Angular DI system to inject the dependency</span></span><br><span class="line">  <span class="comment">// associated with the dependency injection token `TodoDataService`</span></span><br><span class="line">  <span class="comment">// and assign it to a property called `todoDataService`</span></span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params"><span class="keyword">private</span> todoDataService: TodoDataService</span>) &#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Service is now available as this.todoDataService</span></span><br><span class="line">  toggleTodoComplete(todo) &#123;</span><br><span class="line">    <span class="keyword">this</span>.todoDataService.toggleTodoComplete(todo);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The use of public or private on arguments in the constructor is a shorthand notation that allows us to automatically create properties with that name, so:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">class AppComponent &#123;</span><br><span class="line"></span><br><span class="line">  constructor(private todoDataService: TodoDataService) &#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>This is a shorthand notation for:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">class AppComponent &#123;</span><br><span class="line"></span><br><span class="line">  private todoDataService: TodoDataService;</span><br><span class="line"></span><br><span class="line">  constructor(todoDataService: TodoDataService) &#123;</span><br><span class="line">    this.todoDataService = todoDataService;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>AppComponent类最终修改为：<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;Component&#125; <span class="keyword">from</span> <span class="string">'@angular/core'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;Todo&#125; <span class="keyword">from</span> <span class="string">'./todo'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;TodoDataService&#125; <span class="keyword">from</span> <span class="string">'./todo-data.service'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span>(&#123;</span><br><span class="line">  selector: <span class="string">'app-root'</span>,</span><br><span class="line">  templateUrl: <span class="string">'./app.component.html'</span>,</span><br><span class="line">  styleUrls: [<span class="string">'./app.component.css'</span>],</span><br><span class="line">  providers: [TodoDataService]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> AppComponent &#123;</span><br><span class="line"></span><br><span class="line">  newTodo: Todo = <span class="keyword">new</span> Todo();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params"><span class="keyword">private</span> todoDataService: TodoDataService</span>) &#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  addTodo() &#123;</span><br><span class="line">    <span class="keyword">this</span>.todoDataService.addTodo(<span class="keyword">this</span>.newTodo);</span><br><span class="line">    <span class="keyword">this</span>.newTodo = <span class="keyword">new</span> Todo();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  toggleTodoComplete(todo) &#123;</span><br><span class="line">    <span class="keyword">this</span>.todoDataService.toggleTodoComplete(todo);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  removeTodo(todo) &#123;</span><br><span class="line">    <span class="keyword">this</span>.todoDataService.deleteTodoById(todo.id);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">get</span> todos() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.todoDataService.getAllTodos();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>在用浏览器确认结果之前，先运行一下单元测试：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> 11% building 12/12 modules 0 active19 04 2019 16:17:43.842:WARN [karma]: No captured browser, open http://localhost:9876/</span><br><span class="line">19 04 2019 16:17:43.849:INFO [karma-server]: Karma v4.0.1 server started at http://0.0.0.0:9876/</span><br><span class="line">19 04 2019 16:17:43.849:INFO [launcher]: Launching browsers Chrome with concurrency unlimited</span><br><span class="line">19 04 2019 16:17:43.855:INFO [launcher]: Starting browser Chrome                                                                                                                               19 04 2019 16:17:48.227:WARN [karma]: No captured browser, open http://localhost:9876/</span><br><span class="line">19 04 2019 16:17:48.278:INFO [Chrome 73.0.3683 (Windows 10.0.0)]: Connected on socket Cf5Oz6xR4SIbGUxlAAAA with id 5913544</span><br><span class="line">Chrome 73.0.3683 (Windows 10.0.0) AppComponent should create the app FAILED</span><br><span class="line">        Can&apos;t bind to &apos;ngModel&apos; since it isn&apos;t a known property of &apos;input&apos;. (&quot;&quot;&gt;</span><br><span class="line">            &lt;h1&gt;Todos&lt;/h1&gt;</span><br><span class="line">            &lt;input class=&quot;new-todo&quot; placeholder=&quot;What needs to be done?&quot; autofocus=&quot;&quot; [ERROR -&gt;][(ngModel)]=&quot;newTodo.title&quot; (keyup.enter)=&quot;addTodo()&quot;&gt;</span><br><span class="line">          &lt;/header&gt;</span><br><span class="line">          &lt;section class=&quot;main&quot; *ngIf=&quot;tod&quot;): ng:///DynamicTestModule/AppComponent.html@3:78</span><br><span class="line">        Error: Template parse errors:</span><br><span class="line">            at syntaxError (node_modules/@angular/compiler/fesm5/compiler.js:2430:1)</span><br></pre></td></tr></table></figure></p>
<p>错误信息：Can’t bind to ‘ngModel’ since it isn’t a known property of ‘input’. (“”&gt;<br>原因是Angular编译器不识别ngModel,使用TestBed.createComponent()方法的时候，FormsModule没用被AppComponent载入。<br>打开src/app/app.component.spec.ts，引入FormsModule，更新并追加正确的测试用例：<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; TestBed, <span class="keyword">async</span> &#125; <span class="keyword">from</span> <span class="string">'@angular/core/testing'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; RouterTestingModule &#125; <span class="keyword">from</span> <span class="string">'@angular/router/testing'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; AppComponent &#125; <span class="keyword">from</span> <span class="string">'./app.component'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; FormsModule &#125; <span class="keyword">from</span> <span class="string">'@angular/forms'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Todo &#125; <span class="keyword">from</span> <span class="string">'./todo'</span>;</span><br><span class="line"></span><br><span class="line">describe(<span class="string">'AppComponent'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  beforeEach(<span class="keyword">async</span>(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    TestBed.configureTestingModule(&#123;</span><br><span class="line">      imports: [</span><br><span class="line">        RouterTestingModule, </span><br><span class="line">        FormsModule</span><br><span class="line">      ],</span><br><span class="line">      declarations: [</span><br><span class="line">        AppComponent</span><br><span class="line">      ],</span><br><span class="line">    &#125;).compileComponents();</span><br><span class="line">  &#125;));</span><br><span class="line"></span><br><span class="line">  it(<span class="string">'should create the app'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> fixture = TestBed.createComponent(AppComponent);</span><br><span class="line">    <span class="keyword">const</span> app = fixture.debugElement.componentInstance;</span><br><span class="line">    expect(app).toBeTruthy();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  it(<span class="string">`should have a newTodo todo`</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> fixture = TestBed.createComponent(AppComponent);</span><br><span class="line">    <span class="keyword">let</span> app = fixture.debugElement.componentInstance;</span><br><span class="line">    expect(app.newTodo <span class="keyword">instanceof</span> Todo).toBeTruthy()</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  it(<span class="string">'should display "Todos" in h1 tag'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> fixture = TestBed.createComponent(AppComponent);</span><br><span class="line">    fixture.detectChanges();</span><br><span class="line">    <span class="keyword">let</span> compiled = fixture.debugElement.nativeElement;</span><br><span class="line">    expect(compiled.querySelector(<span class="string">'h1'</span>).textContent).toContain(<span class="string">'Todos'</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>运行测试用例，结果如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">11% building 14/14 modules 0 active19 04 2019 16:31:18.154:WARN [karma]: No captured browser, open http://localhost:9876/</span><br><span class="line">19 04 2019 16:31:18.161:INFO [karma-server]: Karma v4.0.1 server started at http://0.0.0.0:9876/</span><br><span class="line">19 04 2019 16:31:18.162:INFO [launcher]: Launching browsers Chrome with concurrency unlimited                                                                                                   11% building 15/15 modules 0 active19 04 2019 16:31:18.173:INFO [launcher]: Starting browser Chrome                                                                                                                               19 04 2019 16:31:22.213:WARN [karma]: No captured browser, open http://localhost:9876/</span><br><span class="line">19 04 2019 16:31:22.276:INFO [Chrome 73.0.3683 (Windows 10.0.0)]: Connected on socket T2dVMSPq7ZeNBQsmAAAA with id 8843769</span><br><span class="line">Chrome 73.0.3683 (Windows 10.0.0): Executed 14 of 14 SUCCESS (0.203 secs / 0.265 secs)</span><br><span class="line">TOTAL: 14 SUCCESS</span><br><span class="line">TOTAL: 14 SUCCESS</span><br></pre></td></tr></table></figure></p>
<p>启动应用程序</p>
<blockquote>
<p>ng serve -o</p>
</blockquote>
<p>画面表示如下：<br><img src="http://static.ohtudou.cc/static/images/learn-angular-part2-2.bmp"></p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">jimmy367</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://www.ohtudou.com/2019/04/16/learn-angular-part2/">http://www.ohtudou.com/2019/04/16/learn-angular-part2/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/angular/">angular</a><a class="post-meta__tags" href="/tags/前端/">前端</a></div><div class="post-qr-code"><div class="post-qr-code-item"><img class="post-qr-code__img" src="http://static.ohtudou.cc/static/images/qr_alipay1.jpg?2022101001"><div class="post-qr-code__desc">支付宝打赏</div></div></div><div class="social-share" data-disabled="google,facebook,diandian,twitter"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script><nav id="pagination"><div class="prev-post pull-left"><a href="/2019/04/18/classic-quotations/"><i class="fa fa-chevron-left">  </i><span>那些经典的句子，句句精辟</span></a></div><div class="next-post pull-right"><a href="/2019/04/15/learn-angular-part1/"><span>（一）Angular CLI入门</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="gitalk-container"></div><script>var gitalk = new Gitalk({
  clientID: '157b2ae2fa3fceeb8953',
  clientSecret: 'e057742d5b33a57e4e2d1742ca70bb8945b2db22',
  repo: 'comments',
  owner: 'jimmy367',
  admin: 'jimmy367',
  id: md5(decodeURI(location.pathname)),
  language: 'en'
})
gitalk.render('gitalk-container')</script></div></div><footer class="footer-bg" style="background-image: url(http://static.ohtudou.cc/static/images/top1.jpg?2022101002)"><div class="layout" id="footer"><div class="copyright">&copy;2017 - 2022 By jimmy367</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.6.1"></script><script src="/js/fancybox.js?version=1.6.1"></script><script src="/js/sidebar.js?version=1.6.1"></script><script src="/js/copy.js?version=1.6.1"></script><script src="/js/fireworks.js?version=1.6.1"></script><script src="/js/transition.js?version=1.6.1"></script><script src="/js/scroll.js?version=1.6.1"></script><script src="/js/head.js?version=1.6.1"></script><script src="/js/search/local-search.js"></script><script>if(/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
}</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>Powered by</span> <a href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>